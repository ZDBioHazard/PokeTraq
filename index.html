<!DOCTYPE html>
<html><head>
    <title>Pok&eacute;Traq</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- FontAwesome -->
    <link rel="stylesheet" href="//unpkg.com/font-awesome@4.6.3/css/font-awesome.min.css" />
    <!-- Leaflet -->
    <link rel="stylesheet" href="//unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="//unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <!-- Leaflet EasyButton -->
    <link rel="stylesheet" href="//unpkg.com/leaflet-easybutton@1.3.1/src/easy-button.css" />
    <script src="//unpkg.com/leaflet-easybutton@1.3.1/src/easy-button.js"></script>
    <!-- Leaflet Locate Control -->
    <link rel="stylesheet" href="//unpkg.com/leaflet.locatecontrol@0.55.0/dist/L.Control.Locate.min.css" />
    <script src="//unpkg.com/leaflet.locatecontrol@0.55.0/dist/L.Control.Locate.min.js" charset="utf-8"></script>

    <style type="text/css">
        html, body, #map { margin: 0; padding: 0; width: 100vw; height: 100vh; }

        .state-clear,
        .state-far { color: #F00; }
        .state-near { color: #0F0; }

        /* Make the Easy Button buttons bigger so you can easily hit them on tiny phones. */
        .easy-button-container .easy-button-button {
            min-width: 0.5in;
            min-height: 0.5in;
            font-size: 0.4in;
            padding: 0.04in;
        }
    </style>
</head><body>
    <div id="map"></div>
    <script>
    // Create a Leaflet map using OpenStreetMap data.
    var map = L.map('map', { center: [35.377, -119.008], zoom: 16, layers: [
        L.tileLayer('//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map by <a href="http://openstreetmap.org">OpenStreetMap</a>',
            minZoom: 5, maxZoom: 17 })] });
    var points = L.layerGroup().addTo(map);
    var me = L.layerGroup().addTo(map);
    var circle_color = '#0F0';

    // Automatically find the user's location on startup.
    L.control.locate({ setView: 'untilPan', icon: 'fa fa-crosshairs',
                       drawMarker: false, drawCircle: false,
                       locateOptions: { maxZoom: 16 }}).addTo(map).start();
    map.on('locationfound', function( ev ) {
        me.clearLayers();
        // Location accuracy circle.
        L.circle(ev.latlng, { radius: ev.accuracy / 2, stroke: 0, color: '#FFF' }).addTo(me);
        // Sightings range circle.
        L.circle(ev.latlng, { radius: 200, color: '#08F', stroke: 0 }).addTo(me);
        // Visible Pokemon circle.
        L.circle(ev.latlng, { radius: 70, color: '#F80', stroke: 0 }).addTo(me);
        // Location dot.
        L.circleMarker(ev.latlng, { radius: 6, stroke: 0, fillOpacity: 1, color: "#FFF" }).addTo(me);
    });

    // Create circles when the map is clicked on.
    map.on('click', function( ev ) {
        // TODO - Remove circles when clicking on the inner circle.
        // Sightings range.
        L.circle(ev.latlng, { radius: 200, color: circle_color, stroke: 1 }).addTo(points);
        // Center dot.
        L.circleMarker(ev.latlng, { radius: 20, color: circle_color, stroke: 0, fillOpacity: 1 }).addTo(points);
    });

    // Circle management controls.
    L.easyBar([
        // Clear all circles button.
        L.easyButton({
            id: 'clear-all',
            states: [{
                stateName: 'clear',
                icon: 'fa-times-circle-o',
                title: "Clear all placed circles",
                onClick: function( ) {
                    points.clearLayers();
                }
            }]
        }),

        // Circle color toggle button.
        L.easyButton({
            id: 'color-toggle',
            states: [{
                stateName: 'near',
                icon: 'fa-dot-circle-o',
                title: "Create green circles",
                onClick: function( button ) {
                    circle_color = '#F00';
                    button.state('far');
                }
            }, {
                stateName: 'far',
                icon: 'fa-dot-circle-o',
                title: "Create red circles",
                onClick: function( button ) {
                    circle_color = '#0F0';
                    button.state('near');
                }
            }]
        }),
    ], { position: 'topright' }).addTo(map);
    </script>
</body></html>
